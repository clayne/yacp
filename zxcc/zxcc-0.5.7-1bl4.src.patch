--- origsrc/zxcc-0.5.7/Makefile.am	2010-07-14 09:06:51.000000000 +0900
+++ src/zxcc-0.5.7/Makefile.am	2025-08-06 07:21:52.005499300 +0900
@@ -1,6 +1,6 @@
 ## Process this file with automake to produce Makefile.in
 
-SUBDIRS= . @LSUBDIRS@ Z80 bin 
+SUBDIRS= . Z80 bin 
 EXTRA_DIST= $(srcdir)/config/* $(srcdir)/zxcc.doc $(srcdir)/zxcc.html
 pkgdata_DATA = zxcc.doc
 
--- origsrc/zxcc-0.5.7/bin/Makefile.am	2001-07-16 06:32:08.000000000 +0900
+++ src/zxcc-0.5.7/bin/Makefile.am	2025-08-06 07:36:03.514235400 +0900
@@ -7,3 +7,4 @@ zxlibr_SOURCES=zxlibr.c
 zxcc_SOURCES=zxbdos.c    zxcbdos.c  zxdbdos.c   zxcc.c             \
 	     z80.c       z80.h      z80ops.h    cbops.h    edops.h \
              zxbdos.h    zxcc.h	    zxcbdos.h   zxdbdos.h
+zxcc_LDADD = $(CPMIO_LIBS) $(CPMREDIR_LIBS)
--- origsrc/zxcc-0.5.7/configure.in	2013-12-28 21:09:53.000000000 +0900
+++ src/zxcc-0.5.7/configure.in	2025-08-06 07:39:03.932876100 +0900
@@ -1,29 +1,14 @@
 dnl Process this file with autoconf to produce a configure script.
-AC_INIT(bin/zxcc.c)
+AC_INIT([zxcc], [0.5.7])
 AC_CONFIG_AUX_DIR(config)
 AC_CONFIG_MACRO_DIR([m4])
 VERSION=0.5.7
 UPDATED='December 28, 2013'
-AM_INIT_AUTOMAKE(zxcc, $VERSION)
+AM_INIT_AUTOMAKE
 AM_CONFIG_HEADER(config.h)
 LT_INIT
 
-dnl Get an absolute version of $srcdir and .
-
-LSUBDIRS=""
-DSTROOT=`pwd`
-if test x"$srcdir" = x
-then
-	SRCROOT=`pwd`
-else
-	cd $srcdir
-	SRCROOT=`pwd`
-	cd $DSTROOT
-fi
-
-
 AC_ARG_WITH(readline,  [  --with-readline         Use GNU Readline for line input (no)])
-AC_ARG_WITH(cpmio,     [  --with-cpmio            Use CPMIO library for output (yes)])
 
 dnl Checks for programs.
 AC_PROG_CC
@@ -33,22 +18,8 @@ then
 	CPPFLAGS="$CPPFLAGS -DUSE_READLINE"
 	AC_CHECK_LIB(readline, readline)
 fi
-
-dnl If using CPMIO, add it to libs. Can't use AC_CHECK_LIB because
-dnl CPMIO hasn't been built yet. 
-if test x"$with_cpmio" != xno 
-then
-	AC_CHECK_LIB(ncurses, printw)
-	AC_CHECK_LIB(curses,  printw)
-	CPPFLAGS="$CPPFLAGS -I$SRCROOT/cpmio/include -DUSE_CPMIO"
-	LDFLAGS="$LDFLAGS -L$DSTROOT/cpmio/lib"
-	LSUBDIRS="$LSUBDIRS cpmio"
-fi
-
-dnl CPMREDIR isn't conditional, so just add it
-CPPFLAGS="$CPPFLAGS -I$SRCROOT/cpmredir/include"
-LDFLAGS="$LDFLAGS -L$DSTROOT/cpmredir/lib"
-LSUBDIRS="$LSUBDIRS cpmredir"
+PKG_CHECK_MODULES(CPMIO, cpmio, [CPPFLAGS="$CPPFLAGS -DUSE_CPMIO"])
+PKG_CHECK_MODULES(CPMREDIR, cpmredir)
 
 dnl General preprocessor symbols
 CPPFLAGS="$CPPFLAGS -DZXCC"
@@ -71,23 +42,11 @@ dnl Checks for library functions.
 AC_FUNC_VPRINTF
 AC_CHECK_FUNCS(strstr)
 
-
-AC_SUBST(LSUBDIRS)
-AC_CONFIG_SUBDIRS($LSUBDIRS)
-
 dnl Location of the ZXCC library directories
 dnl CPPFLAGS="$CPPFLAGS -DLIBROOT=\"$libdir/cpm/\""
 CPPFLAGS="$CPPFLAGS -DBINDIR80=\\\"$libdir/cpm/bin80/\\\""
 CPPFLAGS="$CPPFLAGS -DLIBDIR80=\\\"$libdir/cpm/lib80/\\\""
 CPPFLAGS="$CPPFLAGS -DINCDIR80=\\\"$libdir/cpm/include80/\\\""
 
-dnl Do this last, because adding "-lcpmio" to libraries when there isn't
-dnl in fact a CPMIO library built yet will make other tests go funny.
-if test x"$with_cpmio" != xno 
-then
-	LIBS="-lcpmio $LIBS"
-fi
-LIBS="-lcpmredir $LIBS"
-
 AC_OUTPUT(Makefile bin/Makefile Z80/Makefile )
 
