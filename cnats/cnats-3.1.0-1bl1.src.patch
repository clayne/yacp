--- origsrc/nats.c-3.1.0/CMakeLists.txt	2021-08-26 11:12:42.000000000 +0900
+++ src/nats.c-3.1.0/CMakeLists.txt	2021-09-03 00:17:58.438593100 +0900
@@ -119,7 +119,7 @@ if(NATS_BUILD_USE_SODIUM)
       ${NATS_SODIUM_DIR}
   )
   FIND_LIBRARY(NATS_SODIUM_LIBRARY
-    NAMES libsodium.so libsodium.dylib libsodium.a libsodium.lib libsodium.dll
+    NAMES libsodium.so libsodium.dylib libsodium.a libsodium.lib libsodium.dll sodium.dll
     HINTS ${NATS_SODIUM_DIR}
   )
   FIND_PACKAGE_HANDLE_STANDARD_ARGS(libsodium DEFAULT_MSG
--- origsrc/nats.c-3.1.0/src/CMakeLists.txt	2021-08-26 11:12:42.000000000 +0900
+++ src/nats.c-3.1.0/src/CMakeLists.txt	2021-09-02 23:30:00.903953600 +0900
@@ -59,7 +59,7 @@ if(NATS_BUILD_LIB_SHARED)
   set_property(TARGET nats PROPERTY DEBUG_POSTFIX d)
   target_include_directories(nats PUBLIC
         $<INSTALL_INTERFACE:include>)
-  install(TARGETS nats EXPORT cnats-targets DESTINATION ${NATS_LIBDIR})
+  install(TARGETS nats EXPORT cnats-targets RUNTIME DESTINATION bin ARCHIVE DESTINATION ${NATS_LIBDIR})
   install(EXPORT cnats-targets
         NAMESPACE cnats::
         FILE cnats-config.cmake
--- origsrc/nats.c-3.1.0/test/CMakeLists.txt	2021-08-26 11:12:42.000000000 +0900
+++ src/nats.c-3.1.0/test/CMakeLists.txt	2021-09-02 23:30:00.914929000 +0900
@@ -1,7 +1,7 @@
 if(NOT BUILD_TESTING)
   return()
 endif()
-if(NOT NATS_BUILD_LIB_STATIC)
+if(NOT NATS_BUILD_LIB_STATIC AND NOT CYGWIN)
    MESSAGE(FATAL_ERROR
      "Building tests require static library, or run CMake with -DBUILD_TESTING=OFF")
   return()
@@ -20,8 +20,16 @@ endif(NATS_BUILD_STREAMING)
 # Build the test program
 add_executable(testsuite test.c)
 
-# Link statically with the library
-target_link_libraries(testsuite nats_static ${NATS_EXTRA_LIB})
+# Link with the library
+if(NATS_BUILD_LIB_SHARED)
+  target_link_libraries(testsuite nats ${NATS_EXTRA_LIB})
+elseif(NATS_BUILD_LIB_STATIC)
+  target_link_libraries(testsuite nats_static ${NATS_EXTRA_LIB})
+else()
+  message("Building tests require shared or static library")
+  return()
+endif()
+
 
 # Set the test index to 0
 set(testIndex 0)
