--- origsrc/hkl/Documentation/figures/Makefile.am	2021-09-22 09:48:34.000000000 +0900
+++ src/hkl/Documentation/figures/Makefile.am	2021-09-22 13:03:46.540693600 +0900
@@ -16,9 +16,6 @@ AM_CPPFLAGS = -Wextra -D_DEFAULT_SOURCE
 	$(GOBJECT_CFLAGS) \
 	$(GSL_CFLAGS)
 
-# wee need access to the private part until the trajectory is done.
-AM_LDFLAGS = -Wl,--whole-archive,$(top_builddir)/hkl/.libs/libhkl.a,--no-whole-archive
-
 LDADD = \
 	$(top_builddir)/hkl/libhkl.la \
 	$(top_builddir)/hkl/api2/libhkl2.la \
--- origsrc/hkl/contrib/petra3/Makefile.am	2021-09-22 09:48:35.000000000 +0900
+++ src/hkl/contrib/petra3/Makefile.am	2021-09-22 13:03:07.365344600 +0900
@@ -5,9 +5,6 @@ AM_CPPFLAGS = -Wextra -D_DEFAULT_SOURCE
 	$(GOBJECT_CFLAGS) \
 	$(GSL_CFLAGS)
 
-# wee need access to the private part until the trajectory is done.
-AM_LDFLAGS = -Wl,--whole-archive,$(top_builddir)/hkl/.libs/libhkl.a,--no-whole-archive
-
 LDADD = \
 	$(top_builddir)/hkl/libhkl.la \
 	$(top_builddir)/hkl/api2/libhkl2.la \
--- origsrc/hkl/hkl/api2/Makefile.am	2021-09-22 09:48:36.000000000 +0900
+++ src/hkl/hkl/api2/Makefile.am	2021-09-22 13:00:36.430899700 +0900
@@ -6,9 +6,6 @@ AM_CPPFLAGS = -Wextra -D_DEFAULT_SOURCE
 	$(GLIB_CFLAGS) \
 	$(GSL_CFLAGS)
 
-# need access to the private part
-AM_LDFLAGS = -Wl,--whole-archive,$(top_builddir)/hkl/.libs/libhkl.a,--no-whole-archive
-
 LDADD = \
 	$(GLIB_LIBS) \
 	$(GSL_LIBS)
--- origsrc/hkl/hkl/ccan/coroutine/coroutine.c	2021-09-22 09:48:36.000000000 +0900
+++ src/hkl/hkl/ccan/coroutine/coroutine.c	2021-09-22 11:11:28.618908800 +0900
@@ -59,9 +59,11 @@ struct coroutine_stack *coroutine_stack_
 	struct coroutine_stack *stack;
 	size_t size = bufsize - sizeof(*stack) - metasize;
 
+#if !defined(__CYGWIN__)
 #ifdef MINSIGSTKSZ
 	BUILD_ASSERT(COROUTINE_MIN_STKSZ >= MINSIGSTKSZ);
 #endif
+#endif
 
 	if (bufsize < (COROUTINE_MIN_STKSZ + sizeof(*stack) + metasize))
 		return NULL;
--- origsrc/hkl/hkl/hkl-macros-private.h	2021-09-22 09:48:36.000000000 +0900
+++ src/hkl/hkl/hkl-macros-private.h	2021-09-22 11:19:58.644967400 +0900
@@ -31,7 +31,7 @@
 #define HKL_EULERIAN_KAPPA_SOLUTION 1
 
 /* the assert method */
-#if !defined(NDEBUG) && !_MSC_VER
+#if !defined(NDEBUG) && !_MSC_VER && !defined(__CYGWIN__)
 # include <execinfo.h>
 # include <assert.h>
 # define hkl_assert(x) do{ if (!(x)) {hkl_printbt(); assert(x); } } while(0)
--- origsrc/hkl/hkl/hkl-macros.c	2021-09-22 09:48:36.000000000 +0900
+++ src/hkl/hkl/hkl-macros.c	2021-09-22 11:22:17.105928500 +0900
@@ -19,10 +19,10 @@
  *
  * Authors: Picca Frédéric-Emmanuel <picca@synchrotron-soleil.fr>
  */
-#include <execinfo.h>                   // for backtrace, etc
 #include "hkl-macros-private.h"
 
-#ifndef _MSC_VER
+#if !defined(_MSC_VER) && !defined(__CYGWIN__)
+#include <execinfo.h>                   // for backtrace, etc
 void hkl_printbt(void)
 {
 	void *array[20];
--- origsrc/hkl/tests/Makefile.am	2021-09-22 09:48:36.000000000 +0900
+++ src/hkl/tests/Makefile.am	2021-09-22 13:21:44.181643600 +0900
@@ -40,12 +40,10 @@ AM_CPPFLAGS = -Wextra -D_DEFAULT_SOURCE
 	$(GOBJECT_CFLAGS) \
 	$(GSL_CFLAGS)
 
-AM_LDFLAGS = -Wl,--whole-archive,$(top_builddir)/hkl/.libs/libhkl.a,--no-whole-archive
-
-LDADD = $(top_builddir)/hkl/libhkl.la \
-	$(top_builddir)/hkl/api2/libhkl2.la \
+LDADD = $(top_builddir)/tests/tap/libtap.a \
 	$(top_builddir)/binoculars/libhkl-binoculars.a \
-	$(top_builddir)/tests/tap/libtap.a \
+	$(top_builddir)/hkl/api2/libhkl2.la \
+	$(top_builddir)/hkl/libhkl.la \
 	$(GLIB_LIBS) \
 	$(GOBJECT_LIBS) \
 	$(GSL_LIBS)
