--- origsrc/cpmtools-2.23/Makefile.in	2022-04-20 21:38:53.000000000 +0900
+++ src/cpmtools-2.23/Makefile.in	2022-11-16 11:42:43.998478100 +0900
@@ -41,29 +41,29 @@ all:		$(ALL)
 LibDsk/libdsk.a:
 		cd LibDsk && make
 
-cpmls$(EXEEXT):		cpmls$(OBJEXT) cpmfs$(OBJEXT) getopt$(OBJEXT) getopt1$(OBJEXT) $(DEVICEOBJ) $(LDDEPS)
-		$(CC) $(LDFLAGS) -o $@ cpmls$(OBJEXT) cpmfs$(OBJEXT) getopt$(OBJEXT) getopt1$(OBJEXT) $(DEVICEOBJ) $(LIBS)
+cpmls$(EXEEXT):		cpmls$(OBJEXT) cpmfs$(OBJEXT) $(DEVICEOBJ) $(LDDEPS)
+		$(CC) $(LDFLAGS) -o $@ cpmls$(OBJEXT) cpmfs$(OBJEXT) $(DEVICEOBJ) $(LIBS)
 
-cpmrm$(EXEEXT):		cpmrm$(OBJEXT) cpmfs$(OBJEXT) getopt$(OBJEXT) getopt1$(OBJEXT) $(DEVICEOBJ) $(LDDEPS)
-		$(CC) $(LDFLAGS) -o $@ cpmrm$(OBJEXT) cpmfs$(OBJEXT) getopt$(OBJEXT) getopt1$(OBJEXT) $(DEVICEOBJ) $(LIBS)
+cpmrm$(EXEEXT):		cpmrm$(OBJEXT) cpmfs$(OBJEXT) $(DEVICEOBJ) $(LDDEPS)
+		$(CC) $(LDFLAGS) -o $@ cpmrm$(OBJEXT) cpmfs$(OBJEXT) $(DEVICEOBJ) $(LIBS)
 
-cpmcp$(EXEEXT):		cpmcp$(OBJEXT) cpmfs$(OBJEXT) getopt$(OBJEXT) getopt1$(OBJEXT) $(DEVICEOBJ) $(LDDEPS)
-		$(CC) $(LDFLAGS) -o $@ cpmcp$(OBJEXT) cpmfs$(OBJEXT) getopt$(OBJEXT) getopt1$(OBJEXT) $(DEVICEOBJ) $(LIBS)
+cpmcp$(EXEEXT):		cpmcp$(OBJEXT) cpmfs$(OBJEXT) $(DEVICEOBJ) $(LDDEPS)
+		$(CC) $(LDFLAGS) -o $@ cpmcp$(OBJEXT) cpmfs$(OBJEXT) $(DEVICEOBJ) $(LIBS)
 
-cpmchmod$(EXEEXT):	cpmchmod$(OBJEXT) cpmfs$(OBJEXT) getopt$(OBJEXT) getopt1$(OBJEXT) $(DEVICEOBJ) $(LDDEPS)
-		$(CC) $(LDFLAGS) -o $@ cpmchmod$(OBJEXT) cpmfs$(OBJEXT) getopt$(OBJEXT) getopt1$(OBJEXT) $(DEVICEOBJ) $(LIBS)
+cpmchmod$(EXEEXT):	cpmchmod$(OBJEXT) cpmfs$(OBJEXT) $(DEVICEOBJ) $(LDDEPS)
+		$(CC) $(LDFLAGS) -o $@ cpmchmod$(OBJEXT) cpmfs$(OBJEXT) $(DEVICEOBJ) $(LIBS)
 
-cpmchattr$(EXEEXT):	cpmchattr$(OBJEXT) cpmfs$(OBJEXT) getopt$(OBJEXT) getopt1$(OBJEXT) $(DEVICEOBJ) $(LDDEPS)
-		$(CC) $(LDFLAGS) -o $@ cpmchattr$(OBJEXT) cpmfs$(OBJEXT) getopt$(OBJEXT) getopt1$(OBJEXT) $(DEVICEOBJ) $(LIBS)
+cpmchattr$(EXEEXT):	cpmchattr$(OBJEXT) cpmfs$(OBJEXT) $(DEVICEOBJ) $(LDDEPS)
+		$(CC) $(LDFLAGS) -o $@ cpmchattr$(OBJEXT) cpmfs$(OBJEXT) $(DEVICEOBJ) $(LIBS)
 
-mkfs.cpm$(EXEEXT):	mkfs.cpm$(OBJEXT) cpmfs$(OBJEXT) getopt$(OBJEXT) getopt1$(OBJEXT) $(DEVICEOBJ) $(LDDEPS)
-		$(CC) $(LDFLAGS) -o $@ mkfs.cpm$(OBJEXT) cpmfs$(OBJEXT) getopt$(OBJEXT) getopt1$(OBJEXT) $(DEVICEOBJ) $(LIBS)
+mkfs.cpm$(EXEEXT):	mkfs.cpm$(OBJEXT) cpmfs$(OBJEXT) $(DEVICEOBJ) $(LDDEPS)
+		$(CC) $(LDFLAGS) -o $@ mkfs.cpm$(OBJEXT) cpmfs$(OBJEXT) $(DEVICEOBJ) $(LIBS)
 
-fsck.cpm$(EXEEXT):	fsck.cpm$(OBJEXT) cpmfs$(OBJEXT) getopt$(OBJEXT) getopt1$(OBJEXT) $(DEVICEOBJ) $(LDDEPS)
-		$(CC) $(LDFLAGS) -o $@ fsck.cpm$(OBJEXT) cpmfs$(OBJEXT) getopt$(OBJEXT) getopt1$(OBJEXT) $(DEVICEOBJ) $(LIBS)
+fsck.cpm$(EXEEXT):	fsck.cpm$(OBJEXT) cpmfs$(OBJEXT) $(DEVICEOBJ) $(LDDEPS)
+		$(CC) $(LDFLAGS) -o $@ fsck.cpm$(OBJEXT) cpmfs$(OBJEXT) $(DEVICEOBJ) $(LIBS)
 
-fsed.cpm$(EXEEXT):	fsed.cpm$(OBJEXT) cpmfs$(OBJEXT) term_curses$(OBJEXT) getopt$(OBJEXT) getopt1$(OBJEXT) $(DEVICEOBJ) $(LDDEPS)
-		$(CC) $(LDFLAGS) -o $@ fsed.cpm$(OBJEXT) cpmfs$(OBJEXT) term_curses$(OBJEXT) getopt$(OBJEXT) getopt1$(OBJEXT) $(DEVICEOBJ) $(LIBS)
+fsed.cpm$(EXEEXT):	fsed.cpm$(OBJEXT) cpmfs$(OBJEXT) term_curses$(OBJEXT) $(DEVICEOBJ) $(LDDEPS)
+		$(CC) $(LDFLAGS) -o $@ fsed.cpm$(OBJEXT) cpmfs$(OBJEXT) term_curses$(OBJEXT) $(DEVICEOBJ) $(LIBS)
 
 fsck.test:	fsck.cpm
 		-./fsck.cpm -f ibm-3740 -n badfs/status
@@ -115,4 +115,4 @@ tar:		distclean
 depend:
 		$(MAKEDEPEND) $(CPPFLAGS) *.c >.depend
 
-include .depend
+include @srcdir@/.depend
--- origsrc/cpmtools-2.23/configure.in	2022-11-03 02:35:57.000000000 +0900
+++ src/cpmtools-2.23/configure.in	2022-11-16 11:37:34.948216100 +0900
@@ -50,7 +50,7 @@ AC_CHECK_LIB(curses, printw, FSED_CPM=fs
 if test x"$FSED_CPM" = x""; then
   AC_CHECK_LIB(ncurses, printw, FSED_CPM=fsed.cpm LIBS="-lncurses $LIBS", FSED_CPM=)
   if test x"$FSED_CPM" != x""; then
-    AC_DEFINE(NEED_NCURSES)
+    AC_DEFINE([NEED_NCURSES],,[need ncurses])
     AC_CHECK_HEADERS(ncurses/ncurses.h,have_ncurses_ncurses_h=yes)
   fi
 fi
--- origsrc/cpmtools-2.23/cpm.5	2022-11-03 02:36:05.000000000 +0900
+++ src/cpmtools-2.23/cpm.5	2022-11-16 11:52:04.591572800 +0900
@@ -1,7 +1,7 @@
 .\" Believe it or not, reportedly there are nroffs which do not know \(en
 .if n .ds en -
 .if t .ds en \(en
-.TH CPM 5 "October 10, 2022" "CP/M tools" "File formats"
+.TH CPM 5 "November 2, 2022" "CP/M tools" "File formats"
 .SH NAME \"{{{roff}}}\"{{{
 cpm \- CP/M disk and file system format
 .\"}}}
--- origsrc/cpmtools-2.23/cpmchattr.c	2021-05-13 02:12:54.000000000 +0900
+++ src/cpmtools-2.23/cpmchattr.c	2022-11-16 11:57:28.323050000 +0900
@@ -2,11 +2,12 @@
 #include "config.h"
 
 #include <ctype.h>
+#include <fcntl.h>
 #include <stdio.h>
 #include <string.h>
 #include <stdlib.h>
 
-#include "getopt_.h"
+#include <getopt.h>
 #include "cpmfs.h"
 /*}}}*/
 
--- origsrc/cpmtools-2.23/cpmchmod.c	2021-05-13 02:12:54.000000000 +0900
+++ src/cpmtools-2.23/cpmchmod.c	2022-11-16 11:57:59.540163500 +0900
@@ -3,11 +3,12 @@
 
 #include <ctype.h>
 #include <errno.h>
+#include <fcntl.h>
 #include <stdio.h>
 #include <string.h>
 #include <stdlib.h>
 
-#include "getopt_.h"
+#include <getopt.h>
 #include "cpmfs.h"
 /*}}}*/
 
--- origsrc/cpmtools-2.23/cpmcp.c	2022-01-07 04:40:26.000000000 +0900
+++ src/cpmtools-2.23/cpmcp.c	2022-11-16 11:58:11.345148500 +0900
@@ -5,13 +5,14 @@
 #include <sys/types.h>
 #include <ctype.h>
 #include <errno.h>
+#include <fcntl.h>
 #include <stdio.h>
 #include <string.h>
 #include <limits.h>
 #include <stdlib.h>
 #include <time.h>
 
-#include "getopt_.h"
+#include <getopt.h>
 #include "cpmfs.h"
 /*}}}*/
 
--- origsrc/cpmtools-2.23/cpmfs.c	2022-08-20 19:46:34.000000000 +0900
+++ src/cpmtools-2.23/cpmfs.c	2022-11-16 11:48:09.162146600 +0900
@@ -5,10 +5,13 @@
 #include <assert.h>
 #include <ctype.h>
 #include <errno.h>
+#include <fcntl.h>
+#include <limits.h>
 #include <stdlib.h>
 #include <stdio.h>
 #include <string.h>
 #include <time.h>
+#include <unistd.h>
 
 #include "cpmdir.h"
 #include "cpmfs.h"
--- origsrc/cpmtools-2.23/cpmfs.h	2022-11-03 02:35:35.000000000 +0900
+++ src/cpmtools-2.23/cpmfs.h	2022-11-16 11:48:29.471419100 +0900
@@ -5,6 +5,8 @@
 extern "C" {
 #endif
 
+#include <utime.h>
+
 #include "device.h"
 
 /* CP/M file attributes */
--- origsrc/cpmtools-2.23/cpmls.c	2021-05-14 17:01:32.000000000 +0900
+++ src/cpmtools-2.23/cpmls.c	2022-11-16 11:58:25.654160700 +0900
@@ -3,12 +3,13 @@
 
 #include <ctype.h>
 #include <errno.h>
+#include <fcntl.h>
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
 #include <time.h>
 
-#include "getopt_.h"
+#include <getopt.h>
 #include "cpmfs.h"
 /*}}}*/
 
--- origsrc/cpmtools-2.23/cpmrm.c	2021-05-13 02:12:54.000000000 +0900
+++ src/cpmtools-2.23/cpmrm.c	2022-11-16 11:58:40.221138500 +0900
@@ -3,11 +3,12 @@
 
 #include <ctype.h>
 #include <errno.h>
+#include <fcntl.h>
 #include <stdio.h>
 #include <string.h>
 #include <stdlib.h>
 
-#include "getopt_.h"
+#include <getopt.h>
 #include "cpmfs.h"
 /*}}}*/
 
--- origsrc/cpmtools-2.23/device.h	2021-05-13 02:12:54.000000000 +0900
+++ src/cpmtools-2.23/device.h	2022-11-16 11:45:03.082314100 +0900
@@ -8,6 +8,12 @@
 #define CPMDRV_WINNT 2 /* Windows NT floppy drive accessed via CreateFile */
 #endif
 
+#include <sys/types.h>
+
+#if defined(HAVE_LIBDSK_H)
+#include <libdsk.h>
+#endif
+
 struct Device
 {
   int opened;
--- origsrc/cpmtools-2.23/diskdefs.5	2022-11-03 02:36:06.000000000 +0900
+++ src/cpmtools-2.23/diskdefs.5	2022-11-16 11:52:11.298534800 +0900
@@ -1,7 +1,7 @@
 .\" Believe it or not, reportedly there are nroffs which do not know \(en
 .if n .ds en -
 .if t .ds en \(en
-.TH DISKDEFS 5 "October 10, 2022" "CP/M tools" "File formats"
+.TH DISKDEFS 5 "November 2, 2022" "CP/M tools" "File formats"
 .SH NAME \"{{{roff}}}\"{{{
 diskdefs \- CP/M disk and file system format definitions
 .\"}}}
--- origsrc/cpmtools-2.23/fsck.cpm.c	2021-05-14 02:17:49.000000000 +0900
+++ src/cpmtools-2.23/fsck.cpm.c	2022-11-16 11:58:56.688128100 +0900
@@ -3,12 +3,13 @@
 
 #include <assert.h>
 #include <ctype.h>
+#include <fcntl.h>
 #include <stdio.h>
 #include <string.h>
 #include <stdlib.h>
 #include <errno.h>
 
-#include "getopt_.h"
+#include <getopt.h>
 #include "cpmdir.h"
 #include "cpmfs.h"
 /*}}}*/
--- origsrc/cpmtools-2.23/fsed.cpm.c	2021-05-14 02:16:46.000000000 +0900
+++ src/cpmtools-2.23/fsed.cpm.c	2022-11-16 11:59:10.505163600 +0900
@@ -4,13 +4,14 @@
 #include <assert.h>
 #include <ctype.h>
 #include <errno.h>
+#include <fcntl.h>
 #include <stdlib.h>
 #include <stdio.h>
 #include <string.h>
 #include <time.h>
 
 #include "cpmfs.h"
-#include "getopt_.h"
+#include <getopt.h>
 #include "term.h"
 /*}}}*/
 
--- origsrc/cpmtools-2.23/mkfs.cpm.c	2021-05-13 02:12:54.000000000 +0900
+++ src/cpmtools-2.23/mkfs.cpm.c	2022-11-16 11:56:03.874253700 +0900
@@ -3,12 +3,14 @@
 
 #include <ctype.h>
 #include <errno.h>
+#include <fcntl.h>
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
 #include <time.h>
+#include <unistd.h>
 
-#include "getopt_.h"
+#include <getopt.h>
 #include "cpmfs.h"
 /*}}}*/
 /* #defines */ /*{{{*/
