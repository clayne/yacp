--- origsrc/libHX-4.10/src/socket.c	2023-01-29 23:20:04.000000000 +0900
+++ src/libHX-4.10/src/socket.c	2023-01-31 12:38:52.619958800 +0900
@@ -68,19 +68,23 @@ static int try_sk_from_env(int fd, const
 	    protinfo.iProtocol != ai->ai_protocol)
 		return -1;
 #else
+#if defined(SO_DOMAIN)
 	optlen = sizeof(value);
 	ret = getsockopt(fd, SOL_SOCKET, SO_DOMAIN, &value, &optlen);
 	if (ret < 0 || value != ai->ai_family)
 		return -1;
+#endif
 	optlen = sizeof(value);
 	ret = getsockopt(fd, SOL_SOCKET, SO_TYPE, &value, &optlen);
 	if (ret < 0 || value != ai->ai_socktype)
 		return -1;
+#if defined(SO_PROTOCOL)
 	optlen = sizeof(value);
 	ret = getsockopt(fd, SOL_SOCKET, SO_PROTOCOL, &value, &optlen);
 	if (ret < 0 || value != ai->ai_protocol)
 		return -1;
 #endif
+#endif
 	struct sockaddr_storage addr;
 	memset(&addr, 0, sizeof(addr));
 	optlen = sizeof(addr);
