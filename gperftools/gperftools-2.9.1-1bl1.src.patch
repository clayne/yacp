--- origsrc/gperftools-gperftools-2.9.1/Makefile.am	2021-03-03 12:32:07.000000000 +0900
+++ src/gperftools-gperftools-2.9.1/Makefile.am	2021-08-28 15:22:09.510185900 +0900
@@ -964,7 +964,7 @@ libtcmalloc_la_SOURCES = $(TCMALLOC_CC)
                          $(HEAP_CHECKER_SOURCES)
 libtcmalloc_la_CXXFLAGS = $(PTHREAD_CFLAGS) -DNDEBUG $(AM_CXXFLAGS) \
                           $(MAYBE_NO_HEAP_CHECK) $(EMERGENCY_MALLOC_DEFINE)
-libtcmalloc_la_LDFLAGS = $(PTHREAD_CFLAGS) -version-info @TCMALLOC_SO_VERSION@
+libtcmalloc_la_LDFLAGS = $(PTHREAD_CFLAGS) -no-undefined-version-info @TCMALLOC_SO_VERSION@
 libtcmalloc_la_LIBADD = libtcmalloc_internal.la libmaybe_threads.la $(PTHREAD_LIBS)
 
 # same as above with without -DNDEBUG
--- origsrc/gperftools-gperftools-2.9.1/src/base/basictypes.h	2021-03-03 12:32:07.000000000 +0900
+++ src/gperftools-gperftools-2.9.1/src/base/basictypes.h	2021-08-28 14:20:03.086300600 +0900
@@ -247,7 +247,7 @@ inline void bit_store(Dest *dest, const
   memcpy(dest, source, sizeof(Dest));
 }
 
-#ifdef HAVE___ATTRIBUTE__
+#if defined(HAVE___ATTRIBUTE__) && !defined(__CYGWIN__)
 # define ATTRIBUTE_WEAK      __attribute__((weak))
 # define ATTRIBUTE_NOINLINE  __attribute__((noinline))
 #else
File origsrc/gperftools-gperftools-2.9.1/src/windows/gperftools/tcmalloc.h is a regular file while file src/gperftools-gperftools-2.9.1/src/windows/gperftools/tcmalloc.h is a symbolic link
